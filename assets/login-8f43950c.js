import{r as e,a,u as r,j as s,C as t,I as i,B as n,s as o,g as l,_ as d}from"./index-235a5e66.js";import{b as c}from"./index-0dccc7cd.js";const u=()=>{const[u,m]=e.useState(""),[h,g]=e.useState(""),[p,_]=e.useState(""),v=a(),{login:b,isAuthEnabled:y}=r();return s.jsx("div",{className:"login",children:s.jsx("div",{className:"container",children:s.jsxs(t,{className:"login__card",children:[s.jsx("h1",{className:"login__title",children:"Login"}),!y&&s.jsx("div",{className:"login__warning",role:"alert",children:"Authentication is currently disabled. Please contact the administrator."}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),_(""),y)try{const{data:e,error:t}=await o.from("users").select("*").eq("username",u).single();if(t)return void _("Invalid username or password");if(!e)return void _("Invalid username or password");let i=!1;try{i=await c.compare(h,e.password_hash)}catch(a){return void _("Invalid username or password")}if(!i)return void _("Invalid username or password");try{await Promise.resolve(b(e))}catch(r){}const n=l();if(n){const a=(()=>{try{const e=navigator.userAgent||"";return/Mobi|Android/i.test(e)?"mobile":/Tablet|iPad/i.test(e)?"tablet":"desktop"}catch(e){return"unknown"}})(),{error:r}=await o.from("visitors").update({role:e.role,user_id:e.id,device_type:a}).eq("uuid",n)}try{const{logSuccess:a}=await d(()=>import("./index-235a5e66.js").then(e=>e.i),["assets/index-235a5e66.js","assets/index-da9e0e94.css"]);"function"==typeof a&&a("User logged in",{},{action:"login",actor_type:"user",actor_id:e.id,user_id:e.id})}catch(s){}"admin"===e.role?v("/admin/dashboard"):v("/member/dashboard")}catch(t){_("An error occurred during login")}else _("Authentication is currently disabled. Please contact the administrator.")},className:"login__form",children:[s.jsx(i,{label:"Username",type:"text",name:"username",value:u,onChange:e=>m(e.target.value),required:!0,placeholder:"Enter your username"}),s.jsx(i,{label:"Password",type:"password",name:"password",value:h,onChange:e=>g(e.target.value),required:!0,placeholder:"Enter your password"}),p&&s.jsx("p",{className:"login__error",children:p}),s.jsx(n,{type:"submit",variant:"primary",size:"large",fullWidth:!0,className:"login__button",disabled:!y,children:"Login"})]})]})})})};export{u as default};
