import{r as e,s as a,j as s,B as r,I as l,C as m,P as n,b as i}from"./index-235a5e66.js";import{b as t}from"./index-0dccc7cd.js";const d=()=>{const[d,o]=e.useState([]),[c,u]=e.useState(!0),[h,b]=e.useState(""),[x,j]=e.useState(1),[p,v]=e.useState(10),[N,f]=e.useState(!1),[w,g]=e.useState(!1),[_,y]=e.useState({username:"",password:"",confirmPassword:"",email:"",fullName:"",role:"member"}),[C,P]=e.useState({});e.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:e,error:s}=await a.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;o(e||[])}catch(e){}finally{u(!1)}},M=d.filter(e=>{var a,s;return e.username.toLowerCase().includes(h.toLowerCase())||(null==(a=e.email)?void 0:a.toLowerCase().includes(h.toLowerCase()))||(null==(s=e.full_name)?void 0:s.toLowerCase().includes(h.toLowerCase()))}),q=M.length,E=(x-1)*p,L=E+p,k=M.slice(E,L);e.useEffect(()=>{j(1)},[h]);const D=(e,a)=>{y(s=>({...s,[e]:a})),C[e]&&P(a=>({...a,[e]:""}))},U=e=>{switch(e){case"admin":return"role-badge--admin";case"member":return"role-badge--member";default:return"role-badge--default"}};return c?s.jsx("div",{className:"admin-members",children:s.jsx("div",{className:"container",children:s.jsx("div",{className:"loading-screen",children:s.jsx("p",{children:"Loading members..."})})})}):s.jsx("div",{className:"admin-members",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"admin-members__header",children:[s.jsxs("div",{className:"admin-members__title-section",children:[s.jsx("h1",{className:"admin-members__title",children:"Member Management"}),s.jsx("p",{className:"admin-members__subtitle",children:"View and manage all registered members"})]}),s.jsx(r,{variant:"primary",onClick:()=>f(!0),className:"admin-members__create-btn",children:"+ Create Member"})]}),s.jsx("div",{className:"admin-members__search",children:s.jsx(l,{type:"text",placeholder:"Search by username, email, or name...",value:h,onChange:e=>b(e.target.value),className:"admin-members__search-input"})}),s.jsxs(m,{className:"admin-members__card",children:[s.jsxs("div",{className:"admin-members__stats",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-value",children:d.length}),s.jsx("span",{className:"stat-label",children:"Total Members"})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-value",children:d.filter(e=>"admin"===e.role).length}),s.jsx("span",{className:"stat-label",children:"Admins"})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-value",children:d.filter(e=>"member"===e.role).length}),s.jsx("span",{className:"stat-label",children:"Members"})]})]}),s.jsx("div",{className:"admin-members__list",children:0===k.length?s.jsx("p",{className:"admin-members__empty",children:h?"No members found matching your search.":"No members found."}):k.map(e=>s.jsxs("div",{className:"member-item",children:[s.jsxs("div",{className:"member-item__info",children:[s.jsxs("div",{className:"member-item__primary",children:[s.jsx("strong",{children:e.username}),s.jsx("span",{className:`role-badge ${U(e.role)}`,children:e.role})]}),s.jsxs("div",{className:"member-item__secondary",children:[e.full_name&&s.jsx("span",{children:e.full_name}),e.email&&s.jsx("span",{children:e.email})]})]}),s.jsx("div",{className:"member-item__meta",children:s.jsxs("span",{className:"member-item__date",children:["Joined: ",new Date(e.created_at).toLocaleDateString()]})})]},e.id))}),q>p&&s.jsx(n,{currentPage:x,totalItems:q,itemsPerPage:p,onPageChange:j,onItemsPerPageChange:v})]}),N&&s.jsx("div",{className:"modal-overlay",onClick:()=>f(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{className:"modal-title",children:"Create New Member"}),s.jsx("button",{className:"modal-close",onClick:()=>f(!1),children:"Ã—"})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return _.username.trim()?_.username.length<3&&(e.username="Username must be at least 3 characters"):e.username="Username is required",_.password?_.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",_.password!==_.confirmPassword&&(e.confirmPassword="Passwords do not match"),_.email&&!/\S+@\S+\.\S+/.test(_.email)&&(e.email="Please enter a valid email address"),_.role||(e.role="Role is required"),P(e),0===Object.keys(e).length})()){g(!0);try{const e=10,s=await t.hash(_.password,e),r=`member-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{data:l,error:m}=await a.from("users").insert({uuid:r,username:_.username.trim(),password_hash:s,email:_.email.trim()||null,full_name:_.fullName.trim()||null,role:_.role}).select().single();if(m)throw m;y({username:"",password:"",confirmPassword:"",email:"",fullName:"",role:"member"}),P({}),f(!1),await S(),alert("Member created successfully!")}catch(s){"23505"===s.code?s.message.includes("username")?P({username:"Username already exists"}):s.message.includes("email")&&P({email:"Email already exists"}):alert("Failed to create member. Please try again.")}finally{g(!1)}}},className:"modal-body",children:[s.jsx("div",{className:"form-row",children:s.jsx(l,{label:"Username *",type:"text",name:"username",value:_.username,onChange:e=>D("username",e.target.value),error:C.username,placeholder:"Enter username",required:!0})}),s.jsx("div",{className:"form-row",children:s.jsx(l,{label:"Password *",type:"password",name:"password",value:_.password,onChange:e=>D("password",e.target.value),error:C.password,placeholder:"Enter password",required:!0})}),s.jsx("div",{className:"form-row",children:s.jsx(l,{label:"Confirm Password *",type:"password",name:"confirmPassword",value:_.confirmPassword,onChange:e=>D("confirmPassword",e.target.value),error:C.confirmPassword,placeholder:"Confirm password",required:!0})}),s.jsx("div",{className:"form-row",children:s.jsx(l,{label:"Email",type:"email",name:"email",value:_.email,onChange:e=>D("email",e.target.value),error:C.email,placeholder:"Enter email address"})}),s.jsx("div",{className:"form-row",children:s.jsx(l,{label:"Full Name",type:"text",name:"fullName",value:_.fullName,onChange:e=>D("fullName",e.target.value),placeholder:"Enter full name"})}),s.jsx("div",{className:"form-row",children:s.jsx(i,{label:"Role *",name:"role",value:_.role,onChange:e=>D("role",e),error:C.role,options:[{value:"member",label:"Member"},{value:"admin",label:"Admin"}],required:!0})}),s.jsxs("div",{className:"modal-footer",children:[s.jsx(r,{type:"button",variant:"secondary",onClick:()=>f(!1),disabled:w,children:"Cancel"}),s.jsx(r,{type:"submit",variant:"primary",disabled:w,children:w?"Creating...":"Create Member"})]})]})]})})]})})};export{d as default};
