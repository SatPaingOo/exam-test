import{r as s,s as e,j as a,I as i,C as n,B as t,P as c}from"./index-435157c8.js";const l=()=>{const[l,r]=s.useState([]),[d,o]=s.useState(!0),[m,h]=s.useState(""),[j,u]=s.useState(1),[x,_]=s.useState(10);s.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:s,error:a}=await e.from("quiz_sessions").select("*").order("created_at",{ascending:!1});if(a)throw a;r(s||[])}catch(s){}finally{o(!1)}},N=l.filter(s=>s.code.toLowerCase().includes(m.toLowerCase())||s.uuid.toLowerCase().includes(m.toLowerCase())||s.track.toLowerCase().includes(m.toLowerCase())||s.paper.toLowerCase().includes(m.toLowerCase())),v=N.length,f=(j-1)*x,g=f+x,w=N.slice(f,g);return s.useEffect(()=>{u(1)},[m]),d?a.jsx("div",{className:"admin-sessions",children:a.jsx("div",{className:"container",children:a.jsx("div",{className:"loading-screen",children:a.jsx("p",{children:"Loading sessions..."})})})}):a.jsx("div",{className:"admin-sessions",children:a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"admin-sessions__header",children:[a.jsx("h1",{className:"admin-sessions__title",children:"Quiz Sessions Management"}),a.jsx("p",{className:"admin-sessions__subtitle",children:"Monitor and manage active quiz sessions"})]}),a.jsx("div",{className:"admin-sessions__search",children:a.jsx(i,{type:"text",placeholder:"Search by session code, UUID, track, or paper...",value:m,onChange:s=>h(s.target.value),className:"admin-sessions__search-input"})}),a.jsxs(n,{className:"admin-sessions__card",children:[a.jsxs("div",{className:"admin-sessions__stats",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:l.length}),a.jsx("span",{className:"stat-label",children:"Total Sessions"})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:l.filter(s=>!s.finished).length}),a.jsx("span",{className:"stat-label",children:"Active"})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:l.filter(s=>s.finished).length}),a.jsx("span",{className:"stat-label",children:"Completed"})]})]}),a.jsx("div",{className:"admin-sessions__list",children:0===w.length?a.jsx("p",{className:"admin-sessions__empty",children:m?"No sessions found matching your search.":"No sessions found."}):w.map(s=>a.jsxs("div",{className:"session-item",children:[a.jsxs("div",{className:"session-item__info",children:[a.jsxs("div",{className:"session-item__primary",children:[a.jsxs("strong",{children:["Session: ",s.code]}),a.jsx("span",{className:"status-badge "+(s.finished?"status-badge--completed":"status-badge--active"),children:s.finished?"Completed":"Active"})]}),a.jsxs("div",{className:"session-item__secondary",children:[a.jsxs("span",{children:[s.track," - ",s.paper]}),a.jsxs("span",{children:["UUID: ",s.uuid]})]})]}),a.jsxs("div",{className:"session-item__meta",children:[a.jsxs("div",{className:"session-item__details",children:[a.jsxs("span",{children:["Questions:"," ",s.questions?Object.keys(s.questions).length:0]}),a.jsxs("span",{children:["Answers:"," ",s.answers?Object.keys(s.answers).length:0]}),s.time_spent&&a.jsxs("span",{children:["Time: ",Math.floor(s.time_spent/60),"m"," ",s.time_spent%60,"s"]})]}),a.jsxs("div",{className:"session-item__actions",children:[a.jsxs("span",{className:"session-item__date",children:["Created: ",new Date(s.created_at).toLocaleString()]}),!s.finished&&a.jsx(t,{onClick:()=>(async s=>{if(confirm("Are you sure you want to terminate this session?"))try{const{error:a}=await e.from("quiz_sessions").update({finished:!0}).eq("id",s);if(a)throw a;p(),alert("Session terminated successfully")}catch(a){alert("Failed to terminate session")}})(s.id),variant:"danger",size:"small",children:"Terminate"})]})]})]},s.id))}),v>x&&a.jsx(c,{currentPage:j,totalItems:v,itemsPerPage:x,onPageChange:u,onItemsPerPageChange:_})]})]})})};export{l as default};
