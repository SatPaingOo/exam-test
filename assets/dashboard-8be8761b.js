import{u as e,r as s,s as a,j as t,C as r,L as i,B as d}from"./index-435157c8.js";const n=()=>{const{user:n}=e(),[c,l]=s.useState({examsCompleted:0,totalQuestions:0,averageScore:0,studyTime:0}),[m,o]=s.useState([]),[h,u]=s.useState(!0);s.useEffect(()=>{n&&x()},[n]);const x=async()=>{try{const{data:e,error:s}=await a.from("quiz_sessions").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(s)throw s;const t=(null==e?void 0:e.filter(e=>e.finished))||[],r=t.reduce((e,s)=>{var a;return e+((null==(a=s.questions)?void 0:a.length)||0)},0),i=t.reduce((e,s)=>{const a=s.summary;return a&&void 0!==a.correct&&void 0!==a.total?e+a.correct/a.total*100:e},0),d=t.length>0?i/t.length:0,c=t.reduce((e,s)=>e+(s.time_spent||0),0);l({examsCompleted:t.length,totalQuestions:r,averageScore:Math.round(d),studyTime:Math.round(c/60)});const m=t.slice(0,3).map(e=>{const s=e.summary,a=s?Math.round(s.correct/s.total*100):0,t=a>=70?"Passed":"Failed";return{name:`${e.track.toUpperCase()} ${e.paper.toUpperCase()}`,date:_(e.created_at),score:`${a}%`,status:t,questions:s?`${s.correct}/${s.total}`:"0/0"}});o(m)}catch(e){}finally{u(!1)}},_=e=>{const s=new Date(e),a=new Date,t=Math.abs(a-s),r=Math.ceil(t/864e5);return 1===r?"Today":2===r?"Yesterday":r<=7?r-1+" days ago":r<=30?`${Math.ceil(r/7)} weeks ago`:s.toLocaleDateString()},v=[{title:"Exams Completed",value:c.examsCompleted.toString(),icon:"ðŸ“"},{title:"Total Questions",value:c.totalQuestions.toString(),icon:"â“"},{title:"Average Score",value:`${c.averageScore}%`,icon:"ðŸ“Š"},{title:"Study Time",value:`${c.studyTime}m`,icon:"â±ï¸"}];return t.jsx("div",{className:"member-dashboard",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"member-dashboard__header",children:[t.jsxs("h1",{className:"member-dashboard__title",children:["Welcome back, ",(null==n?void 0:n.full_name)||(null==n?void 0:n.username),"!"]}),t.jsx("p",{className:"member-dashboard__subtitle",children:"Track your progress and continue your learning journey"})]}),h?t.jsxs("div",{className:"loading-screen",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Loading your dashboard..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"member-dashboard__stats",children:v.map((e,s)=>t.jsxs(r,{className:"stat-card",children:[t.jsx("div",{className:"stat-card__icon",children:e.icon}),t.jsxs("div",{className:"stat-card__content",children:[t.jsx("h3",{className:"stat-card__title",children:e.title}),t.jsx("div",{className:"stat-card__value",children:e.value})]})]},s))}),t.jsxs("div",{className:"member-dashboard__section",children:[t.jsx("h2",{className:"member-dashboard__section-title",children:"Recent Exam Results"}),t.jsxs(r,{children:[t.jsx("div",{className:"exam-history",children:m.map((e,s)=>t.jsxs("div",{className:"exam-history__item",children:[t.jsxs("div",{className:"exam-history__info",children:[t.jsx("h4",{className:"exam-history__name",children:e.name}),t.jsxs("p",{className:"exam-history__meta",children:[e.questions," questions â€¢ ",e.date]})]}),t.jsxs("div",{className:"exam-history__result",children:[t.jsx("span",{className:"exam-history__score",children:e.score}),t.jsx("span",{className:`exam-history__status exam-history__status--${e.status.toLowerCase()}`,children:e.status})]})]},s))}),t.jsx("div",{className:"exam-history__footer",children:t.jsx(i,{to:"/member/history",children:t.jsx(d,{variant:"secondary",size:"medium",children:"View All Results"})})})]})]}),t.jsxs("div",{className:"member-dashboard__section",children:[t.jsx("h2",{className:"member-dashboard__section-title",children:"Continue Learning"}),t.jsx("div",{className:"recommended-exams",children:[{id:"ip",name:"ITPEC IP",level:"Beginner",duration:"120 min"},{id:"fe",name:"ITPEC FE",level:"Intermediate",duration:"150 min"},{id:"ap",name:"ITPEC AP",level:"Advanced",duration:"180 min"}].map(e=>t.jsxs(r,{className:"recommended-exam",hover:!0,children:[t.jsx("h3",{className:"recommended-exam__name",children:e.name}),t.jsxs("div",{className:"recommended-exam__meta",children:[t.jsx("span",{className:"recommended-exam__level",children:e.level}),t.jsx("span",{className:"recommended-exam__duration",children:e.duration})]}),t.jsx(i,{to:`/exams/${e.id}`,children:t.jsx(d,{variant:"primary",size:"medium",fullWidth:!0,children:"Start Practice"})})]},e.id))})]})]})]})})};export{n as default};
