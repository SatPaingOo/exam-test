import{r as e,a,u as r,j as s,C as t,I as i,B as l,L as n,s as o,_ as m}from"./index-235a5e66.js";import{b as d}from"./index-0dccc7cd.js";const u=()=>{const[u,c]=e.useState({username:"",password:"",confirmPassword:"",email:"",fullName:""}),[h,g]=e.useState({}),[p,w]=e.useState(!1),_=a(),{isAuthEnabled:f}=r(),x=(e,a)=>{c(r=>({...r,[e]:a})),h[e]&&g(a=>({...a,[e]:""}))};return s.jsx("div",{className:"register",children:s.jsx("div",{className:"container",children:s.jsxs(t,{className:"register__card",children:[s.jsx("h1",{className:"register__title",children:"Create Account"}),s.jsx("p",{className:"register__subtitle",children:"Join us to start your exam preparation journey"}),!f&&s.jsx("div",{className:"register__warning",role:"alert",children:"Authentication is currently disabled. Please contact the administrator."}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f){if((()=>{const e={};return u.username.trim()?u.username.length<3&&(e.username="Username must be at least 3 characters"):e.username="Username is required",u.password?u.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",u.password!==u.confirmPassword&&(e.confirmPassword="Passwords do not match"),u.email.trim()?/\S+@\S+\.\S+/.test(u.email)||(e.email="Please enter a valid email address"):e.email="Email is required",g(e),0===Object.keys(e).length})()){w(!0);try{const{data:e,error:r}=await o.from("users").select("username, email").or(`username.eq.${u.username.trim()},email.eq.${u.email.trim()}`).single();if(e)return void(e.username===u.username.trim()?g({username:"Username already exists"}):g({email:"Email already exists"}));const s=10,t=await d.hash(u.password,s),i=`member-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{data:l,error:n}=await o.from("users").insert({uuid:i,username:u.username.trim(),password_hash:t,email:u.email.trim(),full_name:u.fullName.trim()||null,role:"member"}).select().single();if(n)throw n;try{const{logSuccess:e}=await m(()=>import("./index-235a5e66.js").then(e=>e.i),["assets/index-235a5e66.js","assets/index-da9e0e94.css"]),a=(await m(()=>import("./index-235a5e66.js").then(e=>e.h),["assets/index-235a5e66.js","assets/index-da9e0e94.css"])).getUuid();e("User registered",{},{action:"register",actor_type:"user",actor_id:l.id,user_id:l.id,metadata:{username:l.username},visitor_uuid:a})}catch(a){}alert("Registration successful! Please login with your credentials."),_("/login")}catch(r){alert("Registration failed. Please try again.")}finally{w(!1)}}}else alert("Registration is currently disabled. Please contact the administrator.")},className:"register__form",children:[s.jsx(i,{label:"Username *",type:"text",name:"username",value:u.username,onChange:e=>x("username",e.target.value),error:h.username,placeholder:"Choose a username",required:!0}),s.jsx(i,{label:"Email *",type:"email",name:"email",value:u.email,onChange:e=>x("email",e.target.value),error:h.email,placeholder:"Enter your email address",required:!0}),s.jsx(i,{label:"Full Name",type:"text",name:"fullName",value:u.fullName,onChange:e=>x("fullName",e.target.value),placeholder:"Enter your full name (optional)"}),s.jsx(i,{label:"Password *",type:"password",name:"password",value:u.password,onChange:e=>x("password",e.target.value),error:h.password,placeholder:"Create a password",required:!0}),s.jsx(i,{label:"Confirm Password *",type:"password",name:"confirmPassword",value:u.confirmPassword,onChange:e=>x("confirmPassword",e.target.value),error:h.confirmPassword,placeholder:"Confirm your password",required:!0}),Object.keys(h).length>0&&s.jsx("div",{className:"register__errors",children:s.jsx("p",{children:"Please fix the errors above and try again."})}),s.jsx(l,{type:"submit",variant:"primary",size:"large",fullWidth:!0,className:"register__button",disabled:p||!f,children:p?"Creating Account...":"Create Account"})]}),s.jsx("div",{className:"register__footer",children:s.jsxs("p",{children:["Already have an account?"," ",s.jsx(n,{to:"/login",className:"register__link",children:"Sign in here"})]})})]})})})};export{u as default};
