import{u as W,b as G,a as H,r as i,j as e,L as I}from"./index-d056dc2f.js";import{C as g,B as j}from"./Card-18194f49.js";import{g as V,r as X,b as Y}from"./examData-2b8f6d79.js";function Z(s,c){const r=s.slice();for(let u=r.length-1;u>0;u--){const l=Math.floor(Math.random()*(u+1));[r[u],r[l]]=[r[l],r[u]]}return r.slice(0,c)}const ne=()=>{var C,L;const{track:s,paper:c}=W(),[r]=G(),u=H(),l=Math.max(1,Math.min(100,parseInt(r.get("count")||"20",10))),[d,p]=i.useState([]),[n,m]=i.useState(0),[q,y]=i.useState({}),[O,_]=i.useState(!0),[x,k]=i.useState([]),[f,M]=i.useState([]),[v,P]=i.useState(null),o=i.useMemo(()=>V(s),[s]),z=(o==null?void 0:o.name)||(s==null?void 0:s.toUpperCase());i.useEffect(()=>{if(!o)return;let a=!0;return _(!0),X(s,c).then(({questions:t,paperIds:w,paperOptions:K,resolvedPaperId:T})=>{if(!a)return;const $=Array.isArray(t)?t:[],F=Math.min(l,$.length||l),J=Z($,F);p(J),m(0),y({}),k(K||[]),M(w||[]),P(T||null),_(!1)}),()=>{a=!1}},[s,c,l,o]),i.useEffect(()=>{o||(p([]),y({}),k([]),M([]),P(null),_(!1))},[o]);const N=d[n],h=d.length,E=i.useMemo(()=>h?Math.round((n+1)/h*100):0,[n,h]),b=i.useMemo(()=>{if(!f.length)return[];const a=new Map(x.map(t=>[t.id,t.label]));return f.map(t=>({id:t,label:a.get(t)||t}))},[x,f]),S=i.useMemo(()=>{if(!o)return v||c;const a=b.length?b:x;return Y(s,v||c,a)},[s,o,c,v,x,b]),R=(a,t)=>{y(w=>({...w,[a]:t}))},B=()=>{n<h-1&&m(n+1)},Q=()=>{n>0&&m(n-1)},U=()=>{if(!d.length)return;const a=`${s}-${c}-${Date.now()}`,t=ee(d,q);sessionStorage.setItem(a,JSON.stringify({track:s,paper:c,trackLabel:z,paperLabel:S,papersUsed:f,resolvedPaper:v,countRequested:l,questionsServed:d.length,completedAt:new Date().toISOString(),paperOptions:x,questions:d,answers:q,summary:t})),u(`/result/${a}`)};if(!o)return e.jsx("div",{className:"quiz-play quiz-play--missing",children:e.jsx("div",{className:"container",children:e.jsxs(g,{hover:!1,children:[e.jsx("h1",{className:"quiz-play__title",children:"Unknown track"}),e.jsx("p",{className:"quiz-play__empty",children:"We could not find practice papers for this track. Please select a valid exam from the library."}),e.jsx("div",{className:"quiz-actions",children:e.jsx(I,{to:"/exams",children:e.jsx(j,{variant:"primary",children:"Back to Exams"})})})]})})});if(O)return e.jsx("div",{className:"quiz-play quiz-play--loading",children:e.jsx("div",{className:"container",children:e.jsx(g,{hover:!1,children:e.jsx("p",{className:"quiz-play__loading",children:"Loading questionsâ€¦"})})})});if(!N)return e.jsx("div",{className:"quiz-play quiz-play--empty",children:e.jsx("div",{className:"container",children:e.jsxs(g,{hover:!1,children:[e.jsx("p",{className:"quiz-play__empty",children:"No questions available for this selection. Try choosing a different paper or adjust your filters."}),e.jsx("div",{className:"quiz-actions",children:e.jsx(I,{to:`/exams/${s}`,children:e.jsxs(j,{variant:"outline",children:["Back to ",z]})})})]})})});const A=N.id,D=q[A];return e.jsxs("div",{className:"quiz-play",children:[e.jsx("section",{className:"page-hero page-hero--subtle",children:e.jsxs("div",{className:"container",children:[e.jsx("p",{className:"page-hero__eyebrow",children:"Practice Mode"}),e.jsx("h1",{className:"page-hero__title",children:z}),S?e.jsx("p",{className:"page-hero__subtitle",children:S}):null,e.jsxs("div",{className:"quiz-play__meta",children:[e.jsxs("span",{children:["Question ",n+1]}),e.jsxs("span",{children:["of ",h]})]}),e.jsx("div",{className:"quiz-play__progress",children:e.jsx("div",{className:"quiz-play__progress-bar",style:{width:`${E}%`}})})]})}),e.jsx("section",{className:"quiz-play__content",children:e.jsx("div",{className:"container",children:e.jsxs(g,{hover:!1,className:"quiz-play__card",children:[e.jsxs("div",{className:"quiz-question",children:[e.jsx("h2",{className:"quiz-question__title",children:(C=N.question)==null?void 0:C.text}),e.jsx("div",{className:"quiz-question__options",role:"radiogroup","aria-label":"Answer choices",children:(L=N.options)==null?void 0:L.map(a=>{const t=D===a.id;return e.jsxs("button",{type:"button",onClick:()=>R(A,a.id),className:`quiz-option ${t?"quiz-option--selected":""}`,role:"radio","aria-checked":t,tabIndex:0,children:[e.jsx("span",{className:"quiz-option__indicator","aria-hidden":"true"}),e.jsx("span",{className:"quiz-option__label",children:a.text})]},a.id)})})]}),e.jsxs("div",{className:"quiz-actions",children:[e.jsx(j,{variant:"outline",onClick:Q,disabled:n===0,children:"Previous"}),e.jsx(j,{variant:"outline",onClick:B,disabled:n===h-1,children:"Next"}),e.jsx(j,{variant:"danger",onClick:U,disabled:!h,children:"Finish & Review"})]})]})})})]})};function ee(s,c){let r=0;const u=s.map(p=>{const n=c[p.id],m=n===p.answer;return m&&(r+=1),{id:p.id,picked:n,correctAnswer:p.answer,isCorrect:m}}),l=s.length,d=l?Math.round(r/l*100):0;return{correct:r,total:l,score:d,details:u}}export{ne as default};
