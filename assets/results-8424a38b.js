import{c as s,a as e,u as a,r as t,s as r,j as n,C as i,B as l}from"./index-235a5e66.js";const c=()=>{const{sessionId:c}=s(),o=e(),{user:d}=a(),[u,m]=t.useState(null),[x,p]=t.useState(!0),[h,j]=t.useState(null);t.useEffect(()=>{d&&c&&N()},[d,c]);const N=async()=>{try{p(!0);const{data:s,error:e}=await r.from("quiz_sessions").select("*").eq("code",c).eq("user_id",d.id).single();if(e)throw e;if(!s)return void j("Exam session not found");m(s)}catch(s){j("Failed to load exam results")}finally{p(!1)}};if(x)return n.jsx("div",{className:"exam-results-detail",children:n.jsx("div",{className:"container",children:n.jsxs("div",{className:"loading-screen",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{children:"Loading exam results..."})]})})});if(h||!u)return n.jsx("div",{className:"exam-results-detail",children:n.jsx("div",{className:"container",children:n.jsxs(i,{className:"error-card",children:[n.jsx("h2",{children:"Exam Results Not Found"}),n.jsx("p",{children:h||"The requested exam results could not be found."}),n.jsx(l,{variant:"primary",onClick:()=>o("/member/history"),children:"Back to History"})]})})});const _=u.summary,v=_&&_.correct&&_.total?Math.round(_.correct/_.total*100):null,y=null!==v?v>=70?"Passed":"Failed":null,w="Passed"===y?"status-badge--passed":"status-badge--failed",q=(s=>{if(!s)return{date:"",time:""};const e=new Date(s);return{date:e.toLocaleDateString(),time:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})(u.created_at);return n.jsx("div",{className:"exam-results-detail",children:n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"exam-results-detail__header",children:[n.jsx(l,{variant:"secondary",onClick:()=>o("/member/history"),className:"back-button",children:"← Back to History"}),n.jsxs("div",{className:"exam-results-detail__title",children:[n.jsx("h1",{children:"Exam Results"}),n.jsxs("p",{className:"exam-results-detail__subtitle",children:[u.track.toUpperCase()," ",u.paper.toUpperCase()]})]}),n.jsxs("div",{className:"exam-results-detail__actions",children:[y&&n.jsx("span",{className:`status-badge ${w}`,children:y}),n.jsx(l,{variant:"primary",onClick:()=>o("/member/dashboard"),size:"small",children:"Go to Dashboard"})]})]}),n.jsx(i,{className:"exam-results-detail__summary",children:n.jsx("div",{className:"exam-summary",children:n.jsxs("div",{className:"exam-summary__stats",children:[n.jsxs("div",{className:"summary-stat",children:[n.jsx("span",{className:"summary-stat__label",children:"Final Score:"}),n.jsx("span",{className:"summary-stat__value "+(null!==v?(b=v,b>=80?"score--excellent":b>=70?"score--good":b>=60?"score--average":"score--poor"):""),children:null!==v?`${v}%`:"N/A"})]}),n.jsxs("div",{className:"summary-stat",children:[n.jsx("span",{className:"summary-stat__label",children:"Questions:"}),n.jsx("span",{className:"summary-stat__value",children:_?`${_.correct}/${_.total}`:"N/A"})]}),n.jsxs("div",{className:"summary-stat",children:[n.jsx("span",{className:"summary-stat__label",children:"Time Spent:"}),n.jsx("span",{className:"summary-stat__value",children:(s=>{if(!s)return"0m";const e=Math.floor(s/60),a=s%60;return a>0?`${e}m ${a}s`:`${e}m`})(u.time_spent)})]}),n.jsxs("div",{className:"summary-stat",children:[n.jsx("span",{className:"summary-stat__label",children:"Completed:"}),n.jsxs("span",{className:"summary-stat__value summary-stat__value--multiline",children:[n.jsx("span",{className:"completed-date",children:q.date}),n.jsx("span",{className:"completed-time",children:q.time})]})]})]})})}),n.jsxs(i,{className:"exam-results-detail__questions",children:[n.jsx("h2",{children:"Question Details"}),u.questions&&Array.isArray(u.questions)&&u.questions.length>0?n.jsx("div",{className:"question-results",children:u.questions.map((s,e)=>{const a=((s,e,a)=>{try{const t=s.answer||s.correct_answer||s.correctAnswer;let r=e;!r&&u.answers&&Array.isArray(u.answers)&&(r=u.answers[a]);const n=r&&t&&r===t,i="object"==typeof s.question&&s.question.text?s.question.text:s.question||"Question text not available",l=s.explanation?"object"==typeof s.explanation&&s.explanation.text?s.explanation.text:s.explanation:null;return{questionNumber:a+1,question:i,userAnswerId:r,correctAnswerId:t,isCorrect:n,options:(s.options||[]).map(s=>"object"==typeof s&&s.id&&s.text?s:"string"==typeof s?{id:s.charAt(0).toLowerCase(),text:s}:s),explanation:l}}catch(t){return{questionNumber:a+1,question:"Error loading question",userAnswerId:null,correctAnswerId:null,isCorrect:!1,options:[],explanation:"Error loading explanation"}}})(s,u.answers?u.answers[s.id]:null,e);return n.jsxs("div",{className:"question-result "+(a.isCorrect?"question-result--correct":"question-result--incorrect"),children:[n.jsxs("div",{className:"question-result__header",children:[n.jsxs("span",{className:"question-result__number",children:["Question ",a.questionNumber]}),n.jsx("span",{className:"question-result__status "+(a.isCorrect?"status--correct":"status--incorrect"),children:a.isCorrect?"✓ Correct":"✗ Incorrect"})]}),n.jsxs("div",{className:"question-result__content",children:[n.jsx("p",{className:"question-result__question",children:a.question}),a.options&&a.options.length>0?n.jsxs("div",{className:"question-result__options",children:[n.jsx("h4",{children:"Options:"}),n.jsx("div",{className:"options-list",children:a.options.map(s=>{const e="object"==typeof s&&s.text?s.text:s,t="object"==typeof s&&s.id?s.id:"string"==typeof s?s.charAt(0).toLowerCase():"",r=t===a.userAnswerId,i=t===a.correctAnswerId;let l="option";return i?l+=" option--correct":r&&!a.isCorrect&&(l+=" option--incorrect"),n.jsxs("div",{className:l,children:[n.jsxs("span",{className:"option-label",children:[t.toUpperCase(),"."]}),n.jsx("span",{className:"option-text",children:e}),r&&n.jsx("span",{className:"option-indicator",children:"(Your Answer)"}),i&&!r&&n.jsx("span",{className:"option-indicator",children:"(Correct)"})]},t)})})]}):n.jsxs("div",{className:"question-result__options",children:[n.jsx("h4",{children:"Answer:"}),n.jsxs("div",{className:"answer-summary",children:[a.userAnswerId?n.jsxs("p",{className:"answer "+(a.isCorrect?"answer--correct":"answer--incorrect"),children:["Your Answer: ",a.userAnswerId.toUpperCase()]}):n.jsx("p",{className:"answer answer--not-answered",children:"Your Answer: Not answered"}),a.correctAnswerId&&n.jsxs("p",{className:"answer answer--correct",children:["Correct Answer:"," ",a.correctAnswerId.toUpperCase()]})]})]}),a.explanation&&n.jsxs("div",{className:"question-result__explanation",children:[n.jsx("h4",{children:"Explanation:"}),n.jsx("p",{children:a.explanation})]})]})]},s.id||e)})}):n.jsx("p",{className:"no-questions",children:"No question details available for this exam."})]})]})});var b};export{c as default};
