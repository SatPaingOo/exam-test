import{c as s,e,a as t,r,u as a,j as i,g as n,s as o,l as c,f as u}from"./index-235a5e66.js";import{g as d,r as l}from"./examData-bc8e2dad.js";import"./dummy-e365b94c.js";const m=()=>{const{track:m,paper:f}=s(),[g]=e(),h=t(),p=r.useRef(!1),{user:q}=a(),x=Math.max(1,Math.min(100,parseInt(g.get("count")||"20",10))),z=g.get("session")||"both";return r.useEffect(()=>{if(p.current)return;p.current=!0;(async()=>{if(d(m))try{const{questions:s}=await l(m,f);let e=Array.isArray(s)?s:[];"both"!==z&&(e=e.filter(s=>s.session===z));const t=function(s,e){const t=s.slice();for(let r=t.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[t[r],t[s]]=[t[s],t[r]]}return t.slice(0,e)}(e,Math.min(x,e.length||x)),r=n(),a=Date.now().toString(36)+Math.random().toString(36).substring(2,8),i={code:a,uuid:r,user_id:null==q?void 0:q.id,track:m,paper:f,finished:!1,questions:t,answers:{}},{data:d,error:g}=await o.from("quiz_sessions").insert([i]).select("id").single();g?(c("Error creating quiz session",{error:g.message},{action:"create_quiz_session"}),h("/exams")):(u("Quiz session created",{sessionId:d.id},{action:"create_quiz_session"}),h(`/quiz/session/${a}`))}catch(s){c("Error starting quiz",{error:s.message},{action:"start_quiz_failed"}),h("/exams")}else h("/exams")})()},[m,f,x,z]),i.jsx("div",{className:"quiz-start",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:"Starting quiz..."})})})};export{m as default};
