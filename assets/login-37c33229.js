import{r as e,a as r,u as a,j as s,C as t,I as o,B as i,s as n,g as d,_ as l}from"./index-435157c8.js";import{b as c}from"./index-0dccc7cd.js";const u=()=>{const[u,m]=e.useState(""),[p,g]=e.useState(""),[h,_]=e.useState(""),v=r(),{login:w}=a();return s.jsx("div",{className:"login",children:s.jsx("div",{className:"container",children:s.jsxs(t,{className:"login__card",children:[s.jsx("h1",{className:"login__title",children:"Login"}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),_("");try{const{data:e,error:t}=await n.from("users").select("*").eq("username",u).single();if(t)return void _("Invalid username or password");if(!e)return void _("Invalid username or password");let o=!1;try{o=await c.compare(p,e.password_hash)}catch(r){return void _("Invalid username or password")}if(!o)return void _("Invalid username or password");try{await Promise.resolve(w(e))}catch(a){}const i=d();if(i){const r=(()=>{try{const e=navigator.userAgent||"";return/Mobi|Android/i.test(e)?"mobile":/Tablet|iPad/i.test(e)?"tablet":"desktop"}catch(e){return"unknown"}})(),{error:a}=await n.from("visitors").update({role:e.role,user_id:e.id,device_type:r}).eq("uuid",i)}try{const{logSuccess:r}=await l(()=>import("./index-435157c8.js").then(e=>e.i),["assets/index-435157c8.js","assets/index-94d838fc.css"]);r("User logged in",{},{action:"login",actor_type:"user",actor_id:e.id,user_id:e.id})}catch(s){}"admin"===e.role?v("/admin/dashboard"):v("/member/dashboard")}catch(t){_("An error occurred during login")}},className:"login__form",children:[s.jsx(o,{label:"Username",type:"text",name:"username",value:u,onChange:e=>m(e.target.value),required:!0,placeholder:"Enter your username"}),s.jsx(o,{label:"Password",type:"password",name:"password",value:p,onChange:e=>g(e.target.value),required:!0,placeholder:"Enter your password"}),h&&s.jsx("p",{className:"login__error",children:h}),s.jsx(i,{type:"submit",variant:"primary",size:"large",fullWidth:!0,className:"login__button",children:"Login"})]})]})})})};export{u as default};
