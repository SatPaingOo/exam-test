import{c as e,r as s,j as a,C as r,L as l,B as i,s as t,l as n}from"./index-09ec34ef.js";const c=()=>{var c;const{attemptId:d}=e(),[o,u]=s.useState(null),[m,p]=s.useState(!0);s.useEffect(()=>{(async()=>{var e,s,a,r,l,i;if(p(!0),/^\d+$/.test(d)){const{data:r,error:l}=await t.from("quiz_sessions").select("*").eq("id",d).single();l?(n("Error loading quiz session from DB",{error:l.message,attemptId:d}),u(null)):u({...r,trackLabel:(null==(e=r.track)?void 0:e.toUpperCase())||"Practice",paperLabel:r.paper||"Session",papersUsed:[],resolvedPaper:null,countRequested:(null==(s=r.questions)?void 0:s.length)||0,questionsServed:(null==(a=r.questions)?void 0:a.length)||0,completedAt:r.updated_at,paperOptions:[]})}else{const{data:e,error:s}=await t.from("quiz_sessions").select("*").eq("code",d).single();s?(n("Error loading quiz session from DB by code",{error:s.message,attemptId:d}),u(null)):u({...e,trackLabel:(null==(r=e.track)?void 0:r.toUpperCase())||"Practice",paperLabel:e.paper||"Session",papersUsed:[],resolvedPaper:null,countRequested:(null==(l=e.questions)?void 0:l.length)||0,questionsServed:(null==(i=e.questions)?void 0:i.length)||0,completedAt:e.updated_at,paperOptions:[]})}p(!1)})()},[d]);const h=s.useMemo(()=>o?new Map((o.paperOptions||[]).map(e=>[e.id,e.label])):new Map,[o]);if(m)return a.jsx("div",{className:"quiz-result",children:a.jsx("div",{className:"container",children:a.jsx(r,{hover:!1,children:a.jsx("p",{children:"Loading result..."})})})});if(!o)return a.jsx("div",{className:"quiz-result quiz-result--missing",children:a.jsx("div",{className:"container",children:a.jsxs(r,{hover:!1,children:[a.jsx("h1",{className:"quiz-result__title",children:"Result not found"}),a.jsx("p",{className:"quiz-result__subtitle",children:"The attempt expired or was cleared from this device."}),a.jsx("div",{className:"quiz-actions",children:a.jsx(l,{to:"/exams",children:a.jsx(i,{variant:"primary",children:"Browse Exams"})})})]})})});const{track:x,paper:j,trackLabel:_,paperLabel:v,papersUsed:N=[],paperOptions:q=[],summary:g,countRequested:y}=o,b=_||(null==(c=null==x?void 0:x.toUpperCase)?void 0:c.call(x))||"Practice",w=v||j||"Session",z=g||{score:0,correct:0,total:0,details:[]},f=Array.isArray(N)?[...new Set(N)]:[],A=f.map(e=>h.get(e)||e);return a.jsxs("div",{className:"quiz-result",children:[a.jsx("section",{className:"page-hero",children:a.jsxs("div",{className:"container",children:[a.jsx("div",{className:"page-hero__category",children:a.jsx("span",{className:`category-badge category-badge--${x}`,children:null==x?void 0:x.toUpperCase()})}),a.jsx("p",{className:"page-hero__eyebrow",children:"Attempt Summary"}),a.jsx("h1",{className:"page-hero__title",children:b}),a.jsx("p",{className:"page-hero__subtitle",children:w})]})}),a.jsx("section",{className:"quiz-result__content",children:a.jsx("div",{className:"container",children:a.jsxs(r,{hover:!1,className:"quiz-result__card",children:[a.jsxs("div",{className:"quiz-result__overview",children:[a.jsxs("div",{className:"quiz-result__metric",children:[a.jsx("span",{className:"label",children:"Score"}),a.jsxs("span",{className:"value",children:[z.score,"%"]})]}),a.jsxs("div",{className:"quiz-result__metric",children:[a.jsx("span",{className:"label",children:"Correct"}),a.jsxs("span",{className:"value",children:[z.correct," / ",z.total]})]}),a.jsxs("div",{className:"quiz-result__metric",children:[a.jsx("span",{className:"label",children:"Questions"}),a.jsx("span",{className:"value",children:z.total})]}),y?a.jsxs("div",{className:"quiz-result__metric",children:[a.jsx("span",{className:"label",children:"Requested"}),a.jsx("span",{className:"value",children:y})]}):null,f.length>1?a.jsxs("div",{className:"quiz-result__metric",children:[a.jsx("span",{className:"label",children:"Papers Mixed"}),a.jsx("span",{className:"value",children:f.length})]}):null]}),A.length?a.jsxs("div",{className:"quiz-result__papers",children:[a.jsx("span",{className:"label",children:"Papers Included"}),a.jsx("div",{className:"quiz-result__paper-tags",children:A.map(e=>a.jsx("span",{className:"quiz-result__paper-tag",children:e},e))})]}):null,a.jsx("div",{className:"quiz-result__details",children:z.details.map(e=>a.jsxs("div",{className:"quiz-result__item "+(e.isCorrect?"quiz-result__item--correct":"quiz-result__item--incorrect"),children:[a.jsxs("div",{className:"question-id",children:["Q",e.id]}),a.jsxs("div",{className:"question-text",children:[a.jsx("span",{className:"label",children:"Question"}),a.jsx("span",{className:"value",children:e.question||"(Question text unavailable)"})]}),a.jsxs("div",{className:"answer-summary",children:[a.jsxs("div",{className:"answer-summary__item answer-summary__item--user",children:[a.jsx("span",{className:"answer-summary__label",children:"Your Answer:"}),a.jsx("span",{className:"answer-summary__value",children:e.picked||"Not answered"})]}),a.jsxs("div",{className:"answer-summary__item answer-summary__item--correct",children:[a.jsx("span",{className:"answer-summary__label",children:"Correct Answer:"}),a.jsx("span",{className:"answer-summary__value",children:e.correctAnswer})]})]}),a.jsxs("div",{className:"answers-list",children:[a.jsx("span",{className:"label",children:"Answers"}),a.jsx("ul",{children:(e.answers||[]).map((s,r)=>{let l="object"==typeof s?JSON.stringify(s)+r:String(s)+r,i="";i="object"==typeof s&&null!==s?"string"==typeof s.text&&s.text.length>0?s.text:Array.isArray(s.text)?s.text.filter(e=>"string"==typeof e).join(" "):s.images&&Array.isArray(s.images)||"image"===s.type&&s.source?"[Image Option]":"[Unsupported Option]":"string"==typeof s||"number"==typeof s?s:"[Unsupported Option]";const t=s===e.picked||"object"==typeof s&&s.text===e.picked,n=s===e.correctAnswer||"object"==typeof s&&s.text===e.correctAnswer;return a.jsxs("li",{className:`answer-option${t?" answer-option--picked":""}${n?" answer-option--correct":""}`,children:[a.jsx("span",{children:i}),t&&a.jsx("span",{className:"badge badge--picked",children:"Your choice"}),n&&a.jsx("span",{className:"badge badge--correct",children:"Correct"})]},l)})})]})]},e.id))}),a.jsxs("div",{className:"quiz-actions quiz-actions--end",children:[a.jsx(l,{to:`/exams/${x}`,children:a.jsx(i,{variant:"primary",children:"Retry Session"})}),a.jsx(l,{to:"/exams",children:a.jsx(i,{variant:"outline",children:"Back to Exams"})})]})]})})})]})};export{c as default};
