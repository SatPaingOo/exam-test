import{a as e,c as s,b as a,r as i,j as t,L as n}from"./index-1a60f7dd.js";import{C as r,B as l}from"./Card-3448faa1.js";import{g as o,r as c,b as d}from"./examData-0ead7922.js";import"./dummy-613d8baa.js";const u=()=>{var u,p;const{track:h,paper:m}=e(),[x]=s(),j=a(),q=Math.max(1,Math.min(100,parseInt(x.get("count")||"20",10))),[v,y]=i.useState([]),[g,N]=i.useState(0),[f,_]=i.useState({}),[z,b]=i.useState(!0),[k,w]=i.useState([]),[M,S]=i.useState([]),[C,A]=i.useState(null),$=i.useMemo(()=>o(h),[h]),I=(null==$?void 0:$.name)||(null==h?void 0:h.toUpperCase());i.useEffect(()=>{if(!$)return;let e=!0;return b(!0),c(h,m).then(({questions:s,paperIds:a,paperOptions:i,resolvedPaperId:t})=>{if(!e)return;const n=Array.isArray(s)?s:[],r=function(e,s){const a=e.slice();for(let i=a.length-1;i>0;i--){const e=Math.floor(Math.random()*(i+1));[a[i],a[e]]=[a[e],a[i]]}return a.slice(0,s)}(n,Math.min(q,n.length||q));y(r),N(0),_({}),w(i||[]),S(a||[]),A(t||null),b(!1)}),()=>{e=!1}},[h,m,q,$]),i.useEffect(()=>{$||(y([]),_({}),w([]),S([]),A(null),b(!1))},[$]);const P=v[g],L=v.length,O=i.useMemo(()=>L?Math.round((g+1)/L*100):0,[g,L]),U=i.useMemo(()=>{if(!M.length)return[];const e=new Map(k.map(e=>[e.id,e.label]));return M.map(s=>({id:s,label:e.get(s)||s}))},[k,M]),B=i.useMemo(()=>{if(!$)return C||m;const e=U.length?U:k;return d(h,C||m,e)},[h,$,m,C,k,U]);if(!$)return t.jsx("div",{className:"quiz-play quiz-play--missing",children:t.jsx("div",{className:"container",children:t.jsxs(r,{hover:!1,children:[t.jsx("h1",{className:"quiz-play__title",children:"Unknown track"}),t.jsx("p",{className:"quiz-play__empty",children:"We could not find practice papers for this track. Please select a valid exam from the library."}),t.jsx("div",{className:"quiz-actions",children:t.jsx(n,{to:"/exams",children:t.jsx(l,{variant:"primary",children:"Back to Exams"})})})]})})});if(z)return t.jsx("div",{className:"quiz-play quiz-play--loading",children:t.jsx("div",{className:"container",children:t.jsx(r,{hover:!1,children:t.jsx("p",{className:"quiz-play__loading",children:"Loading questionsâ€¦"})})})});if(!P)return t.jsx("div",{className:"quiz-play quiz-play--empty",children:t.jsx("div",{className:"container",children:t.jsxs(r,{hover:!1,children:[t.jsx("p",{className:"quiz-play__empty",children:"No questions available for this selection. Try choosing a different paper or adjust your filters."}),t.jsx("div",{className:"quiz-actions",children:t.jsx(n,{to:`/exams/${h}`,children:t.jsxs(l,{variant:"outline",children:["Back to ",I]})})})]})})});const D=P.id,E=f[D];return t.jsxs("div",{className:"quiz-play",children:[t.jsx("section",{className:"page-hero page-hero--subtle",children:t.jsxs("div",{className:"container",children:[t.jsx("div",{className:"page-hero__category",children:t.jsx("span",{className:`category-badge category-badge--${h}`,children:(null==$?void 0:$.level)||(null==h?void 0:h.toUpperCase())})}),t.jsx("p",{className:"page-hero__eyebrow",children:"Practice Mode"}),t.jsx("h1",{className:"page-hero__title",children:I}),B?t.jsx("p",{className:"page-hero__subtitle",children:B}):null,t.jsxs("div",{className:"quiz-play__meta",children:[t.jsxs("span",{children:["Question ",g+1]}),t.jsxs("span",{children:["of ",L]})]}),t.jsx("div",{className:"quiz-play__progress",children:t.jsx("div",{className:"quiz-play__progress-bar",style:{width:`${O}%`}})})]})}),t.jsx("section",{className:"quiz-play__content",children:t.jsx("div",{className:"container",children:t.jsxs(r,{hover:!1,className:"quiz-play__card",children:[t.jsxs("div",{className:"quiz-question",children:[t.jsx("h2",{className:"quiz-question__title",children:null==(u=P.question)?void 0:u.text}),t.jsx("div",{className:"quiz-question__options",role:"radiogroup","aria-label":"Answer choices",children:null==(p=P.options)?void 0:p.map(e=>{const s=E===e.id;return t.jsxs("button",{type:"button",onClick:()=>{return s=D,a=e.id,void _(e=>({...e,[s]:a}));var s,a},className:"quiz-option "+(s?"quiz-option--selected":""),role:"radio","aria-checked":s,tabIndex:0,children:[t.jsx("span",{className:"quiz-option__indicator","aria-hidden":"true"}),t.jsx("span",{className:"quiz-option__label",children:e.text})]},e.id)})})]}),t.jsxs("div",{className:"quiz-actions",children:[t.jsx(l,{variant:"outline",onClick:()=>{g>0&&N(g-1)},disabled:0===g,children:"Previous"}),t.jsx(l,{variant:"outline",onClick:()=>{g<L-1&&N(g+1)},disabled:g===L-1,children:"Next"}),t.jsx(l,{variant:"danger",onClick:()=>{if(!v.length)return;const e=`${h}-${m}-${Date.now()}`,s=function(e,s){let a=0;const i=e.map(e=>{const i=s[e.id],t=i===e.answer;t&&(a+=1);let n="";return"string"==typeof e.question?n=e.question:"object"==typeof e.question&&null!==e.question&&(n="string"==typeof e.question.text?e.question.text:Array.isArray(e.question.text)?e.question.text.filter(e=>"string"==typeof e).join(" "):"[Question with images or special content]"),{id:e.id,question:n,answers:e.options||[],picked:i,correctAnswer:e.answer,isCorrect:t}}),t=e.length,n=t?Math.round(a/t*100):0;return{correct:a,total:t,score:n,details:i}}(v,f);sessionStorage.setItem(e,JSON.stringify({track:h,paper:m,trackLabel:I,paperLabel:B,papersUsed:M,resolvedPaper:C,countRequested:q,questionsServed:v.length,completedAt:(new Date).toISOString(),paperOptions:k,questions:v,answers:f,summary:s})),j(`/result/${e}`)},disabled:!L,children:"Finish & Review"})]})]})})})]})};export{u as default};
