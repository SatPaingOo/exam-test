import{c as e,a as s,r as i,j as a,C as n,L as t,B as r,s as o,l,f as c}from"./index-235a5e66.js";import{g as d,b as u}from"./examData-bc8e2dad.js";import"./dummy-e365b94c.js";const p=()=>{var p,h;const{sessionId:m}=e(),x=s(),[j,q]=i.useState([]),[_,v]=i.useState(0),[y,g]=i.useState({}),[N,z]=i.useState(!0),[f,b]=i.useState([]),[w,k]=i.useState([]),[S,C]=i.useState(null),[M,E]=i.useState(""),[$,A]=i.useState(""),[D,B]=i.useState(null),I=i.useMemo(()=>d(M),[M]),P=(null==I?void 0:I.name)||(null==M?void 0:M.toUpperCase());i.useEffect(()=>{m?(async()=>{z(!0);const{data:e,error:s}=await o.from("quiz_sessions").select("*").eq("code",m).single();if(s||!e)return l("Error loading quiz session",{error:null==s?void 0:s.message,sessionCode:m}),void x("/exams");q(e.questions||[]),g(e.answers||{}),b([]),k([]),C(e.paper),E(e.track),A(e.paper),z(!1),B(new Date)})():x("/exams")},[m,x]),i.useEffect(()=>{I||(q([]),g({}),b([]),k([]),C(null),z(!1))},[I]);const Q=j[_],U=j.length,L=i.useMemo(()=>U?Math.round((_+1)/U*100):0,[_,U]),O=i.useMemo(()=>{if(!w.length)return[];const e=new Map(f.map(e=>[e.id,e.label]));return w.map(s=>({id:s,label:e.get(s)||s}))},[f,w]),F=i.useMemo(()=>{if(!I)return S||$;const e=O.length?O:f;return u(M,S||$,e)},[M,I,$,S,f,O]);if(!I)return a.jsx("div",{className:"quiz-play quiz-play--missing",children:a.jsx("div",{className:"container",children:a.jsxs(n,{hover:!1,children:[a.jsx("h1",{className:"quiz-play__title",children:"Unknown track"}),a.jsx("p",{className:"quiz-play__empty",children:"We could not find practice papers for this track. Please select a valid exam from the library."}),a.jsx("div",{className:"quiz-actions",children:a.jsx(t,{to:"/exams",children:a.jsx(r,{variant:"primary",children:"Back to Exams"})})})]})})});if(N)return a.jsx("div",{className:"quiz-play quiz-play--loading",children:a.jsx("div",{className:"container",children:a.jsx(n,{hover:!1,children:a.jsx("p",{className:"quiz-play__loading",children:"Loading questionsâ€¦"})})})});if(!Q)return a.jsx("div",{className:"quiz-play quiz-play--empty",children:a.jsx("div",{className:"container",children:a.jsxs(n,{hover:!1,children:[a.jsx("p",{className:"quiz-play__empty",children:"No questions available for this selection. Try choosing a different paper or adjust your filters."}),a.jsx("div",{className:"quiz-actions",children:a.jsx(t,{to:`/exams/${M}`,children:a.jsxs(r,{variant:"outline",children:["Back to ",P]})})})]})})});const R=Q.id,T=y[R];return a.jsxs("div",{className:"quiz-play",children:[a.jsx("section",{className:"page-hero page-hero--subtle",children:a.jsxs("div",{className:"container",children:[a.jsx("div",{className:"page-hero__category",children:a.jsx("span",{className:`category-badge category-badge--${M}`,children:(null==I?void 0:I.level)||(null==M?void 0:M.toUpperCase())})}),a.jsx("p",{className:"page-hero__eyebrow",children:"Practice Mode"}),a.jsx("h1",{className:"page-hero__title",children:P}),F?a.jsx("p",{className:"page-hero__subtitle",children:F}):null,a.jsxs("div",{className:"quiz-play__meta",children:[a.jsxs("span",{children:["Question ",_+1]}),a.jsxs("span",{children:["of ",U]})]}),a.jsx("div",{className:"quiz-play__progress",children:a.jsx("div",{className:"quiz-play__progress-bar",style:{width:`${L}%`}})})]})}),a.jsx("section",{className:"quiz-play__content",children:a.jsx("div",{className:"container",children:a.jsxs(n,{hover:!1,className:"quiz-play__card",children:[a.jsxs("div",{className:"quiz-question",children:[a.jsx("h2",{className:"quiz-question__title",children:null==(p=Q.question)?void 0:p.text}),Q.session&&a.jsxs("p",{className:"quiz-question__session",children:["Session: ",Q.session]}),a.jsx("div",{className:"quiz-question__options",role:"radiogroup","aria-label":"Answer choices",children:null==(h=Q.options)?void 0:h.map(e=>{const s=T===e.id;return a.jsxs("button",{type:"button",onClick:()=>{return s=R,i=e.id,void g(e=>({...e,[s]:i}));var s,i},className:"quiz-option "+(s?"quiz-option--selected":""),role:"radio","aria-checked":s,tabIndex:0,children:[a.jsx("span",{className:"quiz-option__indicator","aria-hidden":"true"}),a.jsx("span",{className:"quiz-option__label",children:e.text})]},e.id)})})]}),a.jsxs("div",{className:"quiz-actions",children:[a.jsx(r,{variant:"outline",onClick:()=>{_>0&&v(_-1)},disabled:0===_,children:"Previous"}),a.jsx(r,{variant:"outline",onClick:()=>{_<U-1&&v(_+1)},disabled:_===U-1,children:"Next"}),a.jsx(r,{variant:"danger",onClick:async()=>{if(!j.length)return;const e=function(e,s){let i=0;const a=e.map(e=>{const a=s[e.id],n=a===e.answer;n&&(i+=1);let t="";return"string"==typeof e.question?t=e.question:"object"==typeof e.question&&null!==e.question&&(t="string"==typeof e.question.text?e.question.text:Array.isArray(e.question.text)?e.question.text.filter(e=>"string"==typeof e).join(" "):"[Question with images or special content]"),{id:e.id,question:t,answers:e.options||[],picked:a,correctAnswer:e.answer,isCorrect:n}}),n=e.length,t=n?Math.round(i/n*100):0;return{correct:i,total:n,score:t,details:a}}(j,y),s=Object.keys(y).length===j.length,i=D?Math.floor((new Date-D)/1e3):0,a={answers:y,summary:e,finished:s,time_spent:i,updated_at:(new Date).toISOString()},{error:n}=await o.from("quiz_sessions").update(a).eq("code",m);n?(l("Error updating quiz session",{error:n.message,sessionCode:m},{action:"update_quiz_session"}),x(`/result/${m}`)):(c("Quiz session updated",{sessionCode:m},{action:"update_quiz_session"}),x(`/result/${m}`))},disabled:!U,children:"Finish & Review"})]})]})})})]})};export{p as default};
