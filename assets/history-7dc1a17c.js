import{u as s,a as e,r as a,s as i,j as t,B as r,C as n}from"./index-004cc2d7.js";const l=()=>{const{user:l}=s(),c=e(),[o,d]=a.useState([]),[m,h]=a.useState(!0),[x,u]=a.useState("all");a.useEffect(()=>{l&&j()},[l,x]);const j=async()=>{try{let s=i.from("quiz_sessions").select("*").eq("user_id",l.id).order("created_at",{ascending:!1});"completed"===x?s=s.eq("finished",!0):"in-progress"===x&&(s=s.eq("finished",!1));const{data:e,error:a}=await s;if(a)throw a;d(e||[])}catch(s){}finally{h(!1)}},p=s=>{const e=new Date(s);return e.toLocaleDateString()+" at "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},N=s=>{if(!s)return"0m";const e=Math.floor(s/60),a=s%60;return a>0?`${e}m ${a}s`:`${e}m`},_=s=>s>=80?"score--excellent":s>=70?"score--good":s>=60?"score--average":"score--poor",v=s=>{if(!s.finished)return t.jsx("span",{className:"status-badge status-badge--in-progress",children:"In Progress"});const e=s.summary;if(!e||!e.correct||!e.total)return t.jsx("span",{className:"status-badge status-badge--unknown",children:"Unknown"});const a=Math.round(e.correct/e.total*100)>=70?"Passed":"Failed",i="Passed"===a?"status-badge--passed":"status-badge--failed";return t.jsx("span",{className:`status-badge ${i}`,children:a})};return m?t.jsx("div",{className:"member-history",children:t.jsx("div",{className:"container",children:t.jsxs("div",{className:"loading-screen",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Loading your exam history..."})]})})}):t.jsx("div",{className:"member-history",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"member-history__header",children:[t.jsx("h1",{className:"member-history__title",children:"Exam History"}),t.jsx("p",{className:"member-history__subtitle",children:"View all your past exam attempts and results"}),t.jsx("div",{className:"member-history__actions",children:t.jsx(r,{variant:"primary",onClick:()=>window.location.href="/member/dashboard",size:"small",children:"Go to Dashboard"})})]}),t.jsx("div",{className:"member-history__filters",children:t.jsxs("div",{className:"filter-buttons",children:[t.jsxs("button",{className:"filter-btn "+("all"===x?"active":""),onClick:()=>u("all"),children:["All Exams (",o.length,")"]}),t.jsxs("button",{className:"filter-btn "+("completed"===x?"active":""),onClick:()=>u("completed"),children:["Completed (",o.filter(s=>s.finished).length,")"]}),t.jsxs("button",{className:"filter-btn "+("in-progress"===x?"active":""),onClick:()=>u("in-progress"),children:["In Progress (",o.filter(s=>!s.finished).length,")"]})]})}),t.jsx(n,{className:"member-history__card",children:0===o.length?t.jsxs("div",{className:"member-history__empty",children:[t.jsx("h3",{children:"No exam history found"}),t.jsx("p",{children:"You haven't taken any exams yet. Start your first practice exam!"}),t.jsx(r,{variant:"primary",onClick:()=>window.location.href="/exams",children:"Browse Exams"})]}):t.jsx("div",{className:"exam-sessions",children:o.map(s=>{const e=s.summary,a=e&&e.correct&&e.total?Math.round(e.correct/e.total*100):null;return t.jsxs("div",{className:"exam-session",children:[t.jsxs("div",{className:"exam-session__header",children:[t.jsxs("div",{className:"exam-session__info",children:[t.jsxs("h3",{className:"exam-session__title",children:[s.track.toUpperCase()," ",s.paper.toUpperCase()]}),t.jsx("p",{className:"exam-session__date",children:p(s.created_at)})]}),t.jsx("div",{className:"exam-session__status",children:v(s)})]}),t.jsxs("div",{className:"exam-session__details",children:[s.finished&&e?t.jsxs("div",{className:"exam-session__stats",children:[t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-label",children:"Score:"}),t.jsxs("span",{className:`stat-value score ${_(a)}`,children:[a,"%"]})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-label",children:"Questions:"}),t.jsxs("span",{className:"stat-value",children:[e.correct,"/",e.total]})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-label",children:"Time:"}),t.jsx("span",{className:"stat-value",children:N(s.time_spent)})]})]}):t.jsxs("div",{className:"exam-session__progress",children:[t.jsxs("p",{className:"exam-session__progress-text",children:["Exam in progress -"," ",Object.keys(s.answers||{}).length," ","questions answered"]}),t.jsx(r,{variant:"secondary",size:"small",onClick:()=>window.location.href=`/quiz/session/${s.code}`,children:"Continue Exam"})]}),s.finished&&t.jsx("div",{className:"exam-session__actions",children:t.jsx(r,{variant:"primary",size:"small",onClick:()=>(s=>{c(`/member/results/${s.code}`)})(s),children:"View Details"})})]})]},s.id)})})})]})})};export{l as default};
