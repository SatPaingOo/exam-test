import{r as e,a,u as r,j as s,C as t,I as i,B as n,s as o,g as d,_ as l}from"./index-09ec34ef.js";import{b as c}from"./index-0dccc7cd.js";const u=()=>{const[u,m]=e.useState(""),[g,p]=e.useState(""),[_,h]=e.useState(""),v=a(),{login:x}=r();return s.jsx("div",{className:"login",children:s.jsx("div",{className:"container",children:s.jsxs(t,{className:"login__card",children:[s.jsx("h1",{className:"login__title",children:"Login"}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h("");try{const{data:e,error:r}=await o.from("users").select("*").eq("username",u).single();if(r||!e)return void h("Invalid username or password");if(!(await c.compare(g,e.password_hash)))return void h("Invalid username or password");x(e);const s=d();if(s){const a=(()=>{try{const e=navigator.userAgent||"";return/Mobi|Android/i.test(e)?"mobile":/Tablet|iPad/i.test(e)?"tablet":"desktop"}catch(e){return"unknown"}})();await o.from("visitors").update({role:e.role,user_id:e.id,device_type:a}).eq("uuid",s)}try{const{logSuccess:a}=await l(()=>import("./index-09ec34ef.js").then(e=>e.i),["assets/index-09ec34ef.js","assets/index-94d838fc.css"]);a("User logged in",{},{action:"login",actor_type:"user",actor_id:e.id,user_id:e.id})}catch(a){}"admin"===e.role?v("/admin/dashboard"):v("/member/dashboard")}catch(r){h("An error occurred during login")}},className:"login__form",children:[s.jsx(i,{label:"Username",type:"text",name:"username",value:u,onChange:e=>m(e.target.value),required:!0,placeholder:"Enter your username"}),s.jsx(i,{label:"Password",type:"password",name:"password",value:g,onChange:e=>p(e.target.value),required:!0,placeholder:"Enter your password"}),_&&s.jsx("p",{className:"login__error",children:_}),s.jsx(n,{type:"submit",variant:"primary",size:"large",fullWidth:!0,className:"login__button",children:"Login"})]})]})})})};export{u as default};
